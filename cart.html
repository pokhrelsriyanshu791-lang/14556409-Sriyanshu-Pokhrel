{% extends 'base.html' %}
{% block content %}
  <h3>Your Cart</h3>
  {% if items and items|length > 0 %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead><tr><th>#</th><th>Product</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr></thead>
        <tbody>
          {% set total = 0 %}
          {% for it in items %}
          {% set loop_sub = it['price'] * it['quantity'] %}
          {% set total = total + loop_sub %}
          <tr>
            <td>{{ loop.index0 }}</td>
            <td>{{ it['name'] }}</td>
            <td>{{ it['price'] }}</td>
            <td>
              <form method="post" action="/cart/update" class="d-flex">
                <input type="hidden" name="index" value="{{ loop.index0 }}" />
                <input type="number" name="quantity" value="{{ it['quantity'] }}" min="1" class="form-control form-control-sm me-2" style="max-width: 90px;" />
                <button class="btn btn-sm btn-outline-primary" type="submit">Update</button>
              </form>
            </td>
            <td>{{ loop_sub }}</td>
            <td>
              <form method="post" action="/cart/remove">
                <input type="hidden" name="index" value="{{ loop.index0 }}" />
                <button class="btn btn-sm btn-outline-danger" type="submit">Remove</button>
              </form>
            </td>
          </tr>
          {% endfor %}
          <tr>
            <th colspan="4" class="text-end">Total</th>
            <th>{{ total }}</th>
            <th></th>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Bundle Suggestions -->
    {% if bundle_suggestions and bundle_suggestions|length > 0 %}
    <div class="mt-4">
      <h4>Frequently Bought Together</h4>
      <div class="row">
        {% for suggestion in bundle_suggestions %}
        <div class="col-md-6 mb-3">
          <div class="card">
            <div class="card-body">
              <h6 class="card-title">{{ suggestion['Product_B'] }}</h6>
              <p class="card-text">
                <span class="badge bg-primary">{{ "%.1f"|format(suggestion['Confidence'] * 100) }}%</span>
                <small class="text-muted">of {{ suggestion['Product_A'] }} buyers also buy this</small>
              </p>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                  {% if suggestion['Lift'] > 1 %}
                    <span class="text-success">Strong bundle</span>
                  {% elif suggestion['Lift'] > 0.5 %}
                    <span class="text-warning">Moderate bundle</span>
                  {% else %}
                    <span class="text-secondary">Weak bundle</span>
                  {% endif %}
                </small>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
    <a class="btn btn-success" href="/checkout">Proceed to Checkout</a>
  {% else %}
    <p>Your cart is empty.</p>
  {% endif %}
{% endblock %}


