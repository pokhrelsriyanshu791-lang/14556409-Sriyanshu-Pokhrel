{% extends 'base.html' %}
{% block content %}
  <h3>Checkout</h3>
  {% if cart and cart|length > 0 %}
  <div class="table-responsive mb-3">
    <table class="table table-striped table-hover">
      <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Subtotal</th></tr></thead>
      <tbody>
        {% set total = 0 %}
        {% for it in cart %}
        {% set sub = it['price'] * it['quantity'] %}
        {% set total = total + sub %}
        <tr><td>{{ it['name'] }}</td><td>{{ it['price'] }}</td><td>{{ it['quantity'] }}</td><td>{{ sub }}</td></tr>
        {% endfor %}
        <tr><th colspan="3" class="text-end">Total</th><th>{{ total }}</th></tr>
      </tbody>
    </table>
  </div>

  <form method="post" class="mb-3">
    <input type="hidden" name="action" value="send" />
    <button type="submit" class="btn btn-outline-primary">Request OTP</button>
  </form>
  <form method="post" class="mb-3">
    <input type="hidden" name="action" value="verify" />
    <div class="input-group" style="max-width:320px;">
      <input class="form-control" type="text" name="otp" placeholder="Enter 5-digit OTP" maxlength="5" pattern="[0-9]{5}" required />
      <button class="btn btn-success" type="submit">Confirm Order</button>
    </div>
    <div class="form-text">Enter exactly 5 digits</div>
  </form>
  {% endif %}

  {% if bill %}
  <div class="card mt-4">
    <div class="card-body">
      <h5>Order Confirmed</h5>
      <p><strong>Order ID:</strong> {{ bill.order_id }}<br/>
         <strong>Date/Time:</strong> {{ bill.datetime }}</p>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
          <tbody>
            {% for it in bill["items"] %}

            <tr><td>{{ it.name }}</td><td>{{ it.quantity }}</td><td>{{ it.price }}</td><td>{{ it.price * it.quantity }}</td></tr>
            {% endfor %}
            <tr><th colspan="3" class="text-end">Grand Total</th><th>{{ bill.grand_total }}</th></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}
{% endblock %}


